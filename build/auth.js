"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const koa_passport_1=__importDefault(require("koa-passport")),LocalStrategy=require("passport-local").Strategy,bcryptjs_1=__importDefault(require("bcryptjs")),db_1=require("./db"),options={};function comparePass(e,r){return bcryptjs_1.default.compareSync(e,r)}koa_passport_1.default.serializeUser((e,r)=>{r(null,!!e&&e.id)}),koa_passport_1.default.deserializeUser((e,r)=>(0,db_1.db)("user").where({id:e}).first().then(e=>{r(null,e||!1)}).catch(e=>{r(e,void 0)})),koa_passport_1.default.use(new LocalStrategy(options,(e,r,t)=>{(0,db_1.db)("user").where({username:e}).first().then(e=>e&&comparePass(r,e.password)?(process.env.USERID=e.id,t(null,e)):t(null,!1)).catch(e=>t(e))}));