"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.queryHtml=exports.minimalForHtmlQuery=void 0;const fs_1=__importDefault(require("fs")),constants_1=require("../constants"),_helpers_1=require("../routes/_helpers"),utils_1=require("../utils"),minimalForHtmlQuery=e=>Object.assign({user:_helpers_1.helperUsers.ensureAuthenticated(e)?"true":"false",host:(0,utils_1.getHostName)(e),version:process.env.APIVERSION||"v1.0"},e.query);exports.minimalForHtmlQuery=minimalForHtmlQuery;const queryHtml=e=>{const t=`http://${e.host}/v1.0/CreateObservations`,r={};Object.keys(constants_1._DBDATAS).forEach(e=>{r[e]=Object.keys(constants_1._DBDATAS[e].relations)}),"true"==e.user&&(r.CreateObservations=[],r.createDB=[]);let s=fs_1.default.readFileSync(__dirname+"/query.html","utf-8").replace('<link rel="stylesheet" href="./query.css">',"<style>"+fs_1.default.readFileSync(__dirname+"/query.css","utf-8")+"</style>").replace('<script src="query.js"><\/script>',"<script>"+fs_1.default.readFileSync(__dirname+"/query.js","utf-8")+"<\/script>");const a=e.results?"jsonObj = JSON.parse(`"+e.results+"`); jsonViewer.showJSON(jsonObj);":"";return Object.keys(e).forEach(t=>{s=s.replace(`,param${(0,utils_1.camelCase)(t,!0)}=""`,`,param${(0,utils_1.camelCase)(t,!0)}="${e[t]}"`)}),s.replace('"@relations@"',JSON.stringify(r)).replace("// @start@",a).replace("@action@",t).replace("@datas@",e.datas?e.datas:"")};exports.queryHtml=queryHtml;